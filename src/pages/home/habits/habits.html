<ion-header>
  <ion-navbar color="home">
    <button ion-button menuToggle>
      <ion-icon name="menu"></ion-icon>
    </button>
    <ion-title>
      <scope></scope>
      Habits
    </ion-title>
    <ion-buttons end>
      <!-- TODO: Fixing issue: The selectScope is needed because the ion-buttons stop click propagation somehow! -->
      <button ion-button icon-only (click)="selectScope()">
        <scope [showIcon]="true" [showText]="false"></scope>
      </button>
      <button ion-button icon-only (click)="showOptions($event)">
        <ion-icon name="more"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content>
  <ion-spinner *ngIf="loading"></ion-spinner>
  <ion-item-divider color="light">
    Habits
    <ion-icon item-right [name]="icons.ORDER" (click)="toggleReorder()"></ion-icon>
  </ion-item-divider>
  <div *ngIf="!loading && habits">
      <ion-list [reorder]="reorder" (ionItemReorder)="reorderHabits($event)" no-margin>
        <ion-item *ngFor="let edge of habits?.edges" class="item-wrapper">
          <habit-item *ngIf="edge.node as habit" [habit]="habit" (tap)="navCtrl.push('HabitPage', {id: habit.id})" (press)="toggleReorder()"></habit-item>
        </ion-item>
      </ion-list>
  </div>
  <ion-item-divider color="light">
    Routines
    <ion-icon item-right [name]="icons.ORDER" (click)="toggleReorder()"></ion-icon>
  </ion-item-divider>
  <div *ngIf="!loading && routines">
      <ion-list [reorder]="reorder" (ionItemReorder)="reorderRoutines($event)" no-margin>
        <ion-item *ngFor="let edge of routines?.edges" class="item-wrapper">
          <routine-item *ngIf="edge.node as routine" [routine]="routine" (tap)="navCtrl.push('RoutinePage', {id: routine.id})" (press)="toggleReorder()"></routine-item>
        </ion-item>
      </ion-list>
  </div>
  <div *ngIf="!loading && hero" (click)="update()">
    <ion-item-divider color="light">Notes</ion-item-divider>
    <div padding-horizontal>
      <markdown [data]="hero.routines || '...'"></markdown>
    </div>
  </div>
  <div class="fab-bottom-spacer"></div>
  <ion-fab bottom right>
    <button ion-fab (click)="create()">
      <ion-icon [name]="icons.CREATE"></ion-icon>
    </button>
  </ion-fab>
</ion-content>
