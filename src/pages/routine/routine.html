<ion-header>
  <ion-navbar color="home">
    <ion-title>Routine</ion-title>
    <ion-buttons end>
      <button ion-button icon-only (click)="delete()">
        <ion-icon [name]="icons.DELETE"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content>
  <ion-spinner *ngIf="loading"></ion-spinner>
  <div *ngIf="!loading && routine" class="content">
    <ion-item no-lines>
      <h1>
        <span (click)="updateName()">{{ routine.name || '...' }}</span>
      </h1>
    </ion-item>
    <ion-list margin-left>
      <ion-chip (click)="updateScope()">
        <ion-icon [name]="icons.SCOPE"></ion-icon>
        <ion-label>{{ routine.scope.toLowerCase() | titlecase }}</ion-label>
      </ion-chip>
    </ion-list>
    <div padding class="content" (click)="updateContent()">
      <markdown [data]="routine.content || '...'"></markdown>
    </div>
    <ion-item-divider color="light">
      <ion-icon [name]="icons.HABITS"></ion-icon>
      Habits
      <ion-icon item-right [name]="icons.ORDER" (click)="toggleReorder()" padding-right></ion-icon>
      <ion-icon item-right [name]="icons.CREATE" (click)="addHabits()"></ion-icon>
    </ion-item-divider>
    <ion-list [reorder]="reorder" (ionItemReorder)="reorderHabits($event)" no-margin>
      <ion-item *ngFor="let edge of routine.routineHabits.edges" class="item-wrapper">
        <habit-item *ngIf="edge.node.habit as habit" [habit]="habit" [showTracker]="true" (tracked)="trackHabit(habit, $event)" (click)="navCtrl.push('HabitPage', {id: habit.id})"></habit-item>
      </ion-item>
    </ion-list>
  </div>
</ion-content>
